<!DOCTYPE html>
<html>
<head>
  <title>Standard Naming</title>
  <script src="https://unpkg.com/vue"></script>
</head>
<body>

  <div id="app">
    <textarea ref="multiLineInput" v-on:blur="splitData" hidden></textarea>
    <template v-for="(msg,index) in messages">
      <computed-logical
        v-model="msg.logical"
        v-bind:get-id="getId(index)"
        v-bind:physical="physical(index)"
        v-bind:business="business(index)"
        v-bind:standard-define="standardDefine(index)"
        v-on:add-new-row="addNewRow(index)"
        v-on:delete-row="deleteRow(index)"
      ></computed-logical>
    </template>
  </div>

  <script src="https://unpkg.com/lodash@4.13.1/lodash.min.js"></script>
  <script>

    const textArea = document.getElementById("textArea")

    Vue.component('computed-logical', {
      template: '\
        <div>\
          <button v-on:click="deleteRow()">Delete</button>\
          <input\
            ref="getId"\
            v-bind:value="value"\
            v-on:input="updateValue($event.target.value)"\
            v-on:keyup.enter="addNewRow($event.target.value)"\
            v-on:paste="sendToTextarea()"\
          >\
          {{ physical }}\
          {{ business }}\
          {{ standardDefine }}\
        </div>\
      ',
      props: {
        value: {
          type: String,
          default: ''
        },
        getId: {
          type: String,
          default: 'logical-0'
        },
        physical: {
          type: String,
          default: ''
        },
        business: {
          type: String,
          default: ''
        },
        standardDefine: {
          type: String,
          default: 'NO'
        }
      },
      methods: {
        updateValue: function (value) {
          this.$emit('input', value)
        },
        addNewRow: function (value) {
          if(value !== '') {
            this.$emit('add-new-row')
          }
        },
        deleteRow: function () {
          this.$emit('delete-row')
        },
        setFocus: function () {
          this.$refs.getId.focus()
        },
        sendToTextarea: function(e) {
          this.$parent.$refs.multiLineInput.removeAttribute('hidden')
          this.$parent.$refs.multiLineInput.focus()

          setTimeout(this.focusOnInput, 10);
        },
        focusOnInput: function() {
          this.$refs.getId.focus()
        }
      },
      mounted: function () {
        this.setFocus()
      },
      updated: function () {
        this.setFocus()
      },
    })

    new Vue({
      el: '#app',
      data: {
        messages : [{ logical: '' }]
      },
      methods: {
        getId: function (index) {
          return "logical-" + index
        },
        physical: function (index) {
          return this.messages[index].logical
        },
        business: function (index) {
          return this.messages[index].logical
        },
        standardDefine: function (index) {
          if(this.messages[index].logical.length % 2 === 0) {
            return 'YES'
          } else {
            return 'NO'
          }
        },
        addNewRow: function (index) {
          this.messages.splice(index+1,0,{ logical: '' })
        },
        deleteRow: function (index) {
          if( this.messages.length > 1 ) {
            this.messages.splice(index,1)
          }
        },
        splitData: function() {
          if(this.messages[this.messages.length-1].logical === ''){
            this.messages.pop()
          }

          this.$refs.multiLineInput.value.split('\n').forEach(this.pushData)

          this.$refs.multiLineInput.value = ''
          this.$refs.multiLineInput.setAttribute("hidden","hidden");
        },
        pushData: function(value, index) {
          this.messages.push({ logical: value })
        }
      }
    })

  </script>
</body>
</html>
