<!DOCTYPE html>
<html>
<head>
  <title>Standard Naming</title>
  <script src="https://unpkg.com/vue"></script>
</head>
<body>

  <div id="app">
    <template v-for="(msg,index) in messages">
      <currency-input
        v-model="msg.logical"
        v-bind:get-id="getId(index)"
        v-bind:physical="physical(index)"
        v-bind:business="business(index)"
        v-bind:standard-define="standardDefine(index)"
        v-on:add-new-row="addNewRow(index)"
        v-on:delete-row="deleteRow(index)"
      ></currency-input>
    </template>
  </div>

  <script src="https://unpkg.com/lodash@4.13.1/lodash.min.js"></script>
  <script>

    Vue.component('currency-input', {
      template: '\
        <div>\
          <button v-on:click="deleteRow()">Delete</button>\
          <input\
            ref="input"\
            v-bind:id="getId"\
            v-bind:value="value"\
            v-on:input="updateValue($event.target.value)"\
            v-on:keyup.enter="addNewRow($event.target.value)"\
          >\
          {{ physical }}\
          {{ business }}\
          {{ standardDefine }}\
        </div>\
      ',
      props: {
        value: {
          type: String,
          default: ''
        },
        getId: {
          type: String,
          default: 'logical-0'
        },
        physical: {
          type: String,
          default: ''
        },
        business: {
          type: String,
          default: ''
        },
        standardDefine: {
          type: String,
          default: 'NO'
        }
      },
      methods: {
        updateValue: function (value) {
          this.$emit('input', value)
        },
        addNewRow: function (value) {
          if(value !== '') {
            this.$emit('add-new-row')
          }
        },
        deleteRow: function () {
          this.$emit('delete-row')
        },
        setFocus: function () {
          document.getElementById(this.getId).focus();
        }
      },
      mounted: function () {
        this.setFocus()
      },
      updated: function () {
        this.setFocus()
      },
    })

    new Vue({
      el: '#app',
      data: {
        messages : [{ logical: '' }]
      },
      methods: {
        getId: function (index) {
          return "logical-" + index
        },
        physical: function (index) {
          return this.messages[index].logical
        },
        business: function (index) {
          return this.messages[index].logical
        },
        standardDefine: function (index) {
          if(this.messages[index].logical.length % 2 === 0) {
            return 'YES'
          } else {
            return 'NO'
          }
        },
        addNewRow: function (index) {
          this.messages.splice(index+1,0,{ logical: '' })
        },
        deleteRow: function (index) {
          if( this.messages.length > 1 ) {
            this.messages.splice(index,1)
          }
        }
      }
    })

  </script>
</body>
</html>
